{% extends "layout.html" %}

{% block content %}
<h2>Add Value</h2>

<!-- Form to add new value -->
<form method="post">
    <label>Account:
        <select name="account_id" required>
            {% for account in accounts %}
                <option value="{{ account.id }}">{{ account.name }}</option>
            {% endfor %}
        </select>
    </label><br>
    
    <label>Date: <input type="date" name="date" required></label><br>
    <label>Value: <input type="number" step="0.01" name="value" required></label><br>
    <button type="submit">Add Value</button>
</form>

<!-- Table to display values sorted by date -->
<h3>Existing Values</h3>
<table border="1" id="valuesTable">
    <thead>
        <tr>
            <th>Account Name</th>
            <th>Account Number</th>
            <th>Institution</th>
            <th>Owner</th>
            <th>Value</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody id="valuesTableBody">
        <!-- Data will be populated by JavaScript -->
    </tbody>
</table>

{% endblock %}

{% block scripts %}
<script>
    // Function to fetch and display values
    function loadAccountValues() {
        fetch('/get_account_values')
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById('valuesTableBody');
                tableBody.innerHTML = '';  // Clear existing rows
                
                data.forEach(item => {
                    const row = document.createElement('tr');
                    
                    const accountNameCell = document.createElement('td');
                    accountNameCell.textContent = item.account_name;
                    row.appendChild(accountNameCell);
                    
                    const accountNumberCell = document.createElement('td');
                    accountNumberCell.textContent = item.account_number;
                    row.appendChild(accountNumberCell);
                    
                    const institutionCell = document.createElement('td');
                    institutionCell.textContent = item.institution;
                    row.appendChild(institutionCell);
                    
                    const ownerCell = document.createElement('td');
                    ownerCell.textContent = item.owner;
                    row.appendChild(ownerCell);
                    
                    const valueCell = document.createElement('td');
                    valueCell.textContent = item.value;  // Dollar amount formatted from backend
                    row.appendChild(valueCell);
                    
                    const dateCell = document.createElement('td');
                    dateCell.textContent = new Date(item.date).toLocaleDateString();
                    row.appendChild(dateCell);
                    
                    tableBody.appendChild(row);
                });
            });
    }
    
    // Load account values on page load
    document.addEventListener('DOMContentLoaded', loadAccountValues);
</script>
{% endblock %}
